# ĞĞšĞĞĞ§ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ™ ĞĞ¢Ğ§Ğ•Ğ¢: Ğ£ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ±ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

## âœ… Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞĞ«Ğ• Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯

### 1. ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ñ…ÑƒĞºĞ¸
- `useCardInstances` â†’ Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½ Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ¾Ğ¹ Ñ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸ÑĞ¼Ğ¸
- `useOptimizedCardInstances` â†’ Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½ Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ¾Ğ¹ Ñ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸ÑĞ¼Ğ¸  
- `useCardInstanceSync` â†’ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
- `useCardHealthSync` â†’ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½

### 2. Ğ—Ğ°Ğ¼ĞµĞ½ĞµĞ½Ñ‹ Ğ²ÑĞµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ½Ğ° Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ…ÑƒĞº
- `src/components/game/medical/MedicalBayComponent.tsx`
- `src/components/game/shelter/WorkersManagement.tsx`
- `src/components/game/team/DeckSelection.tsx`
- `src/components/game/adventures/game/hooks/usePlayerStats.ts`
- `src/hooks/team/useTeamBattle.ts`
- `src/hooks/team/useTeamSelection.ts`
- `src/hooks/useCardsWithHealth.ts`

### 3. ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ RPC Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹
- `src/utils/battleHealthUtils.ts` - Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ `update_card_instance_health_by_template`
- `src/components/Shop.tsx` - Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ `create_worker_card_instance`

### 4. ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- `useGameSync` - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ‘Ğ” Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ°
- `useCardInstanceSync` Ğ² `useGameSync` Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½

## ğŸ¯ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ ĞŸĞĞ¡Ğ›Ğ• ĞĞŸĞ¢Ğ˜ĞœĞ˜Ğ—ĞĞ¦Ğ˜Ğ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ĞšĞĞœĞŸĞĞĞ•ĞĞ¢Ğ«                  â”‚
â”‚  - MedicalBay                       â”‚
â”‚  - WorkersManagement                â”‚ 
â”‚  - DeckSelection                    â”‚
â”‚  - PlayerStats                      â”‚
â”‚  - TeamBattle                       â”‚
â”‚  - TeamSelection                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ…ÑƒĞº
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   useCentralizedCardInstances       â”‚
â”‚   - ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ğ½Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ          â”‚
â”‚   - ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ                     â”‚
â”‚   - ĞŸĞ°ĞºĞµÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      cardInstanceManager            â”‚
â”‚   âœ… ĞšÑÑˆ Ğ½Ğ° 30 ÑĞµĞºÑƒĞ½Ğ´               â”‚
â”‚   âœ… Ğ‘Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2-5 ÑĞµĞº         â”‚
â”‚   âœ… ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñ‹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸   â”‚
â”‚   âœ… ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ğ±ĞµĞ· Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SUPABASE RPC              â”‚
â”‚  - get_card_instances_by_wallet     â”‚
â”‚  - create_card_instance_by_wallet   â”‚
â”‚  - remove_card_instance_by_wallet   â”‚
â”‚  - update_card_instance_health      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ĞĞ–Ğ˜Ğ”ĞĞ•ĞœĞ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢

- **Ğ”Ğ**: ~30,000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
- **ĞŸĞĞ¡Ğ›Ğ•**: <100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ (ÑĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² 300+ Ñ€Ğ°Ğ·)

### ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ñ‹ ÑĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸:
1. **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** - Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ 30 ÑĞµĞºÑƒĞ½Ğ´
2. **ĞŸĞ°ĞºĞµÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸** - Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2-5 ÑĞµĞºÑƒĞ½Ğ´
3. **ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸** - Ğ¾Ğ´Ğ¸Ğ½ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
4. **Ğ”ĞµĞ±Ğ°ÑƒĞ½Ñ** - real-time ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ½Ğ° 3 ÑĞµĞºÑƒĞ½Ğ´Ñ‹
5. **ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñ‹** - Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 1 Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ² 30 ÑĞµĞºÑƒĞ½Ğ´ Ğ½Ğ° ĞºĞ¾ÑˆĞµĞ»ĞµĞº

## ğŸ” ĞœĞĞĞ˜Ğ¢ĞĞ Ğ˜ĞĞ“

Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ:
- `CardInstanceManager: Using cached data` - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºÑÑˆĞ°
- `CardInstanceManager: Loading from DB` - Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ğ‘Ğ”  
- `Processing batch of X operations` - Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¿Ğ°ĞºĞµÑ‚Ğ°
- `Card instance creation/deletion/update queued` - Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
- `DISABLED` - Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

## âš ï¸ Ğ’ĞĞ–ĞĞ

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ **Ğ’Ğ¡Ğ•** Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ°Ğ¼Ğ¸ ĞºĞ°Ñ€Ñ‚ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸Ğ´Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ·:
```typescript
import { useCentralizedCardInstances } from '@/hooks/useCentralizedCardInstances';
```

Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ Ñ…ÑƒĞºĞ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ¸ Ñ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸ÑĞ¼Ğ¸.